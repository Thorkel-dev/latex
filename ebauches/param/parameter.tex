\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[pdftex]{graphicx}
\usepackage{xspace}
\usepackage{lastpage}
\usepackage{hyperref}
\usepackage{subfiles}
\usepackage{longtable}
\usepackage{titlesec}
\usepackage{float}
\usepackage[dvipsnames]{xcolor}
\usepackage{fancyhdr}
\usepackage{xltabular}
\usepackage{enumitem}
\usepackage[nottoc,numbib]{tocbibind}
\usepackage[outputdir=build/, newfloat]{minted}
\usepackage{caption}

\usepackage{lipsum}
\usepackage[outdir=build/epstopdf/, update]{epstopdf}

%-----------------------------------------------
%   Customize margins
%-----------------------------------------------

\usepackage[left=2.5cm,
    right=2.5cm,
    top=2.5cm,
    bottom=2.5cm
]{geometry}
\geometry{body={160mm,230mm},headheight=42pt,top=3cm}
\RequirePackage{kvoptions}

%-----------------------------------------------
%   Variables
%-----------------------------------------------

\graphicspath{{../schemas/}{../figures/}}

\hypersetup{
    colorlinks  = true,
    linkcolor   = black,
    filecolor   = red,
    urlcolor    = blue,
    pdfborder   = 0 0 0
}

\definecolor{ESEORed}{RGB}{59,13,32}
\definecolor{ESEOOrange}{RGB}{91,29,15}
\definecolor{ESEOLightBlue}{RGB}{41,78,87}
\definecolor{ESEODarkBlue}{RGB}{11,46,74}
\definecolor{ESEOGrey}{RGB}{35,35,35}
\definecolor{ESEOWhite}{RGB}{1,1,1}
\definecolor{thorkelBlue}{RGB}{0, 0, 60}

% itemize personalization
\setlist[itemize]{label=\textcolor{black}{\textbullet}}

% Does not work on all Debian distributions
\newcommand{\sectionbreak}{\clearpage} % New page for each section

%-----------------------------------------------
%   Settings for header and footer
%-----------------------------------------------

\pagenumbering{arabic}
\pagestyle{fancy}
\makeatletter

% header
\renewcommand{\headrulewidth}{0.4mm}
\fancyhead[LO]{\includegraphics[height= 15pt]{eseo-logo.png} \\ \medskip {\projectName}}
\fancyhead[CO]{\includegraphics[height= 15pt]{thorkel-logo.png} \\ \medskip {\prose} Ã©quipe {\teamNumber} {\annee}}
\fancyhead[RO]{\includegraphics[height= 15pt]{latex.png} \\ \medskip {\small{Ref. {\documentNameAbrev}\_E{\teamNumber}}}}
\def\headrule{{\if@fancyplain\let\headrulewidth\plainheadrulewidth\fi
            \color{ESEOLightBlue}\hrule\@height\headrulewidth\@width\headwidth \vskip-\headrulewidth}}

% footer
\renewcommand{\footrulewidth}{0.4mm}
\fancyfoot[LO]{\textit{Version {\version} - Revision {\revision}}}
\fancyfoot[CO]{\copyright {\annee} E. Gautier, {\teamName}}
\fancyfoot[RO]{Page \thepage /{\pageref{Lastpage}} }
\def\footrule{{\if@fancyplain\let\footrulewidth\plainfootrulewidth\fi
            \vskip-\footruleskip\vskip-\footrulewidth
            \color{ESEOLightBlue}\hrule\@width\headwidth\@height\footrulewidth\vskip\footruleskip}}

%-----------------------------------------------
%   The titles of the parts
%-----------------------------------------------

% Adds a sub-subparagraph level
\newcounter{subsubparagraph}[subparagraph]
\renewcommand\thesubsubparagraph{%
    \thesubparagraph.\@arabic\c@subsubparagraph}
\newcommand\subsubparagraph{%
    \@startsection{subsubparagraph}               % counter
    {6}                                           % level
    {0em}                                         % indentation
    {1em}                                         % before the title
    {1em}                                         % after the title
    {\normalsize\hspace{6em}\color{thorkelBlue}} % style (overloaded by the title format)
}
\newcommand\l@subsubparagraph{\@dottedtocline{6}{13em}{6em}}
\newcommand{\subsubparagraphmark}[1]{}
\providecommand*{\toclevel@subsubparagraph}{6}
\makeatother % is used again normally

\setcounter{tocdepth}{6}    % Allows the paragraph in the table of contents
\setcounter{secnumdepth}{6} % Allows the numbering of the sub-paragraph

% title format
\titleformat{\section}[block]{\normalfont\bfseries\LARGE\color{thorkelBlue}}{{\thesection}}{1em}{}{}
\titleformat{\subsection}[block]{\Large\hspace{2em}\Large\color{thorkelBlue}}{{\thesubsection}}{1em}{}{}
\titleformat{\subsubsection}[block]{\hspace{3em}\large\color{thorkelBlue}}{{\thesubsubsection}}{1em}{}{}
\titleformat{\paragraph}[block]{\normalsize\bfseries\hspace{4em}\color{thorkelBlue}}{{\theparagraph}}{1em}{}{}
\titleformat{\subparagraph}[block]{\normalsize\hspace{5em}\color{thorkelBlue}}{{\thesubparagraph}}{1em}{}{}

%-----------------------------------------------
%   Customization of the list of figures
%-----------------------------------------------

\renewcommand{\listoffigures}{\begingroup
    \tocsection
    \tocfile{\listfigurename}{lof}
    \endgroup}

\newcounter{@secnumdepth}
\let\oldsection\section
\RenewDocumentCommand{\section}{s o m}{%
    \IfBooleanTF{#1}
    {%
        \setcounter{@secnumdepth}{\value{secnumdepth}}  % Stocke secnumdepth
        \setcounter{secnumdepth}{-1}                    % Show only up to order numbers
        \phantomsection%
        \oldsection{#3}% \section*
        \setcounter{secnumdepth}{\value{@secnumdepth}}  % Restore secnumdepth
    }
    {%
        \IfValueTF{#2}% \section
        {% \section[.]{..}
            \oldsection[#2]{#3}%
        }
        {% \section{..}
            \oldsection{#3}%
        }
    }
}

%-----------------------------------------------
%   Glossary customization
%-----------------------------------------------

\usepackage[acronym, numberedsection, nonumberlist, automake]{glossaries-extra} % To make a glossary

\glstocfalse
\glsenablehyper
\setglossarystyle{altlistgroup}
\setabbreviationstyle{short-postfootnote}

\ProvideDocumentCommand{\printglossdef}{o m}{\footnote{#1: #2}}
\GlsXtrEnableEntryUnitCounting{general}{0}{page} % Count the number of occurrences per unit, per page of the general group
\GlsXtrEnableEntryUnitCounting{abbreviation}{0}{page} % Count the number of occurrences per unit, per page of the general group

% If this is the first occurrence of the label
%   then delete the hyperlink to the glossary
% otherwise
%   If the label is already present in the page (see GlsXtrEnableEntryUnitCounting)
%       then delete the hyperlink
%    otherwise do nothing
\renewcommand{\glslinkcheckfirsthyperhook}{%
    \glsxtrifwasfirstuse%
    {\setkeys{glslink}{hyper=false}}%
    {%
        \ifnum\glsentrycurrcount\glslabel>0%
            \setkeys{glslink}{hyper=false}%
        \fi
    }%
}

% If this is the first occurrence of the label
%   then a footnote is added with the description linked to the tag
% otherwise do nothing
\renewcommand{\glsxtrpostlink}{%
    \glsxtrifwasfirstuse%
    {\printglossdef[\glsentryname{\glslabel}]{\glsentrydesc{\glslabel}}}%
    {}%
}

%-----------------------------------------------
%   Minted personalization
%-----------------------------------------------

\definecolor{vs}{rgb}{0.95,0.95,0.95}
\setminted{
    linenos=true,
    autogobble=true,            % Align with margin
    numbers=left,               % Line number
    fontsize=\footnotesize,     % Font size
    bgcolor=vs,                 % Background color
    tabsize=4,                  % Tab size
    fontfamily=courier,         % Font size
    breaklines,                 % Auto line break
}
% Environment to list the code
\newenvironment{code}{\captionsetup{type=listing}}{\par\hspace{2em}}

\SetupFloatingEnvironment{listing}{name=Source Code}      % Title in the legend
\renewcommand*{\listlistingname}{Source code table} % Title of the list

%-----------------------------------------------
% Personnalisation de la bibliographie
%-----------------------------------------------

\usepackage[
    backend=biber,
    citestyle=verbose-note,     % Citation style
    style=reading,              % Style of the bibliography
    entrykey = false,           % The key is not displayed
    sorting = nty,              % Sort by name, title, year
    hyperref = false,           % Link between the citation and the bibliography
    backref = false,            % Do not display the citations page
]{biblatex}